<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Feedback Review - Misclassifications</title>
  <style>
    body { font-family: "Inter", sans-serif; background:#f7f9fc; margin:40px; color:#222; }
    h1 { color:#2563eb; text-align:center; }
    .stats { display:flex; justify-content:center; gap:30px; margin:20px 0; }
    .stat { background:white; padding:20px 30px; border-radius:16px; box-shadow:0 4px 8px rgba(0,0,0,0.05); text-align:center; }
    .misclassification { background:white; padding:20px; margin:15px 0; border-radius:8px; box-shadow:0 2px 4px rgba(0,0,0,0.1); }
    .query { font-size:18px; font-weight:600; color:#333; margin-bottom:10px; }
    .codes { display:flex; gap:20px; margin:10px 0; }
    .code { padding:8px 15px; border-radius:6px; }
    .predicted { background:#fee; color:#c00; border:2px solid #fcc; }
    .actual { background:#efe; color:#060; border:2px solid #cfc; }
    .metadata { font-size:14px; color:#666; margin-top:10px; }
    .actions { margin-top:15px; }
    .btn { padding:8px 16px; border:none; border-radius:6px; cursor:pointer; margin-right:10px; }
    .btn-primary { background:#2563eb; color:white; }
    .btn-primary:hover { background:#1d4ed8; }
    .filter { background:white; padding:20px; border-radius:8px; margin-bottom:20px; }
  </style>
</head>
<body>
  <h1>üîç Feedback Review - Misclassifications</h1>

  <div class="stats">
    <div class="stat">
      <h3>Total Misclassifications</h3>
      <p style="font-size:24px; font-weight:bold;">{{ stats.total_misclassifications }}</p>
    </div>
    <div class="stat">
      <h3>Accuracy Rate</h3>
      <p style="font-size:24px; font-weight:bold;">{{ "%.1f"|format(stats.accuracy_rate * 100) }}%</p>
    </div>
    <div class="stat">
      <h3>Total Feedback</h3>
      <p style="font-size:24px; font-weight:bold;">{{ stats.total_feedback }}</p>
    </div>
  </div>

  <div class="filter">
    <form method="get" style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
      <label style="min-width:120px;">Filter by Action Code:</label>
      <input type="text" name="action_code" value="{{ action_code_filter or '' }}" placeholder="e.g., SEARCH_PRODUCT" style="padding:8px; border-radius:4px; border:1px solid #ddd; flex:1; max-width:300px;">
      <label>Limit:</label>
      <input type="number" name="limit" value="{{ limit or 50 }}" min="1" max="200" style="padding:8px; border-radius:4px; border:1px solid #ddd; width:80px;">
      <button type="submit" class="btn btn-primary">Filter</button>
      <a href="/dashboard/feedback-review" class="btn" style="background:#6b7280; color:white; text-decoration:none; display:inline-block;">Clear</a>
    </form>
  </div>

  <div style="margin-top:30px;">
    <h2>Misclassified Examples ({{ misclassifications|length }})</h2>
    
    {% if misclassifications %}
      {% for item in misclassifications %}
      <div class="misclassification">
        <div class="query">{{ item.query }}</div>
        <div class="codes">
          <div class="code predicted">
            <strong>Predicted:</strong> {{ item.predicted_action_code }}
          </div>
          <div class="code actual">
            <strong>Actual:</strong> {{ item.actual_action_code }}
          </div>
        </div>
        <div class="metadata">
          <strong>Confidence:</strong> {{ "%.2f"|format(item.confidence) }} | 
          <strong>Timestamp:</strong> {{ item.timestamp[:19] }} | 
          <strong>Request ID:</strong> {{ item.request_id[:8] }}...
        </div>
        {% if item.comment %}
        <div style="margin-top:10px; padding:10px; background:#f9fafb; border-radius:4px;">
          <strong>Comment:</strong> {{ item.comment }}
        </div>
        {% endif %}
      </div>
      {% endfor %}
    {% else %}
      <div style="text-align:center; padding:40px; color:#666;">
        <p>No misclassifications found. Great job! üéâ</p>
      </div>
    {% endif %}
  </div>

  <div style="margin-top:40px; text-align:center;">
    <a href="/api/v1/feedback/export?format=csv" class="btn btn-primary" download>Export CSV</a>
    <a href="/api/v1/feedback/export?format=json" class="btn btn-primary" download>Export JSON</a>
  </div>
</body>
</html>
